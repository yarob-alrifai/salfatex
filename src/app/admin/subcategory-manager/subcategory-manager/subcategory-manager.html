<section class="p-8 bg-gray-50 min-h-screen">
  <header class="mb-8 text-center">
    <h2 class="text-3xl font-bold text-indigo-600">ุฅุฏุงุฑุฉ ุงูุชุตูููุงุช ุงููุฑุนูุฉ</h2>
    <p class="text-gray-600 mt-2">
      ูู ุจุฑุจุท ุงูุชุตูููุงุช ุงููุฑุนูุฉ ุจุงูุชุตูููุงุช ุงูุฑุฆูุณูุฉ ูุน ุฅููุงููุฉ ุฅุถุงูุฉ ุตูุฑุฉ ููุตู ููู ุชุตููู ูุฑุนู.
    </p>
  </header>

  <div
    *ngIf="editingSubcategory()"
    class="mb-6 bg-amber-50 border border-amber-200 text-amber-700 rounded-xl p-4 flex flex-col gap-3 text-right md:flex-row md:items-center md:justify-between"
  >
    <div>
      <h3 class="text-lg font-semibold">ูุถุน ุงูุชุนุฏูู</h3>
      <p class="text-sm mt-1">
        ุฃูุช ุชููู ุจุชุนุฏูู ุงูุชุตููู ุงููุฑุนู:
        <span class="font-medium text-amber-800">{{ editingSubcategory()?.name }}</span>
      </p>
    </div>
    <button
      type="button"
      (click)="cancelEdit()"
      class="self-end md:self-auto bg-amber-500 hover:bg-amber-600 text-white font-medium py-2 px-4 rounded-lg shadow transition"
    >
      ุฅูุบุงุก ุงูุชุนุฏูู
    </button>
  </div>

  <form
    [formGroup]="form"
    (ngSubmit)="saveSubcategory()"
    class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-white p-6 rounded-xl shadow text-right"
  >
    <label class="flex flex-col gap-2">
      <span class="font-medium text-gray-700">ุงูุชุตููู ุงูุฑุฆูุณู</span>
      <select
        formControlName="categoryId"
        class="border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
      >
        <option value="" disabled>ุงุฎุชุฑ ุงูุชุตููู</option>
        <option *ngFor="let category of categories$ | async" [value]="category.id">
          {{ category.name }}
        </option>
      </select>
    </label>

    <label class="flex flex-col gap-2">
      <span class="font-medium text-gray-700">ุงุณู ุงูุชุตููู ุงููุฑุนู</span>
      <input
        formControlName="name"
        placeholder="ุฃููุดุฉ ุฑุฌุงููุฉ"
        class="border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
      />
    </label>

    <label class="flex flex-col gap-2 md:col-span-2">
      <span class="font-medium text-gray-700">ุงููุตู</span>
      <textarea
        formControlName="description"
        rows="3"
        placeholder="ุฃุฏุฎู ูุตููุง ูุฎุชุตุฑูุง ููุชุตููู ุงููุฑุนู"
        class="border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-indigo-400"
      ></textarea>
    </label>

    <label class="flex flex-col gap-2 md:col-span-2">
      <span class="font-medium text-gray-700">ุตูุฑุฉ ุชุนุฑูููุฉ</span>
      <input
        type="file"
        accept="image/*"
        (change)="onImageChange($event)"
        class="border border-dashed border-indigo-300 rounded-lg p-3 bg-indigo-50 text-indigo-700"
      />
      <span *ngIf="imageFileName()" class="text-sm text-gray-500">{{ imageFileName() }}</span>
    </label>

    <button type="submit">ุญูุธ</button>
    <p class="feedback" *ngIf="feedback()">{{ feedback() }}</p>
    <div class="md:col-span-2 flex flex-col gap-3 md:flex-row md:items-center md:justify-end">
      <button
        type="submit"
        class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-6 rounded-lg shadow transition"
      >
        {{ editingSubcategory() ? '๐ ุชุญุฏูุซ ุงูุชุตููู ุงููุฑุนู' : '๐พ ุญูุธ ุงูุชุตููู ุงููุฑุนู' }}
      </button>
      <button
        *ngIf="editingSubcategory()"
        type="button"
        (click)="cancelEdit()"
        class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-6 rounded-lg shadow transition"
      >
        ุฅูุบุงุก
      </button>
    </div>

    <p class="md:col-span-2 text-center text-green-600 font-medium" *ngIf="feedback()">
      {{ feedback() }}
    </p>
  </form>

  <section class="mt-10 space-y-6" *ngIf="subcategoriesView$ | async as subcategories">
    <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between text-right">
      <p class="text-gray-600">
        ุงุฎุชุฑ ุงูุชุตููู ุงูุฑุฆูุณู ูู ุงููููุฐุฌ ุฃุนูุงู ูุนุฑุถ ุงูุชุตูููุงุช ุงููุฑุนูุฉ ุงููุฑุชุจุทุฉ ุจู.
      </p>
      <span class="text-sm text-gray-500"
        >ุฅุฌูุงูู ุงูุชุตูููุงุช ุงููุฑุนูุฉ ุงููุนุฑูุถุฉ: {{ subcategories.length }}</span
      >
    </div>

    <div class="bg-white rounded-xl shadow overflow-hidden">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 text-right">
          <thead class="bg-gray-100 text-gray-700 text-sm">
            <tr>
              <th class="px-4 py-3 font-semibold">ุงูุงุณู</th>
              <th class="px-4 py-3 font-semibold">ุงููุตู</th>
              <th class="px-4 py-3 font-semibold">ุงูุชุตููู ุงูุฑุฆูุณู</th>
              <th class="px-4 py-3 font-semibold">ุงูุตูุฑุฉ</th>
              <th class="px-4 py-3 font-semibold">ุงูุฅุฌุฑุงุกุงุช</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 text-sm text-gray-700">
            <tr *ngFor="let subcategory of subcategories" class="hover:bg-gray-50">
              <td class="px-4 py-3 font-medium text-gray-900">{{ subcategory.name }}</td>
              <td class="px-4 py-3">{{ subcategory.description || 'ูุง ููุฌุฏ ูุตู' }}</td>
              <td class="px-4 py-3">{{ subcategory.categoryName }}</td>
              <td class="px-4 py-3">
                <ng-container *ngIf="subcategory.imageUrl; else noImage">
                  <img
                    [src]="subcategory.imageUrl"
                    alt="ุตูุฑุฉ {{ subcategory.name }}"
                    class="w-16 h-16 object-cover rounded-lg border border-gray-200 inline-block"
                  />
                </ng-container>
                <ng-template #noImage>โ</ng-template>
              </td>
              <td class="px-4 py-3">
                <div class="flex items-center justify-end gap-2">
                  <button
                    type="button"
                    (click)="startEdit(subcategory)"
                    class="bg-amber-500 hover:bg-amber-600 text-white py-1 px-3 rounded-lg shadow transition"
                  >
                    โ๏ธ ุชุนุฏูู
                  </button>
                  <button
                    type="button"
                    (click)="deleteSubcategory(subcategory)"
                    class="bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded-lg shadow transition"
                  >
                    ๐๏ธ ุญุฐู
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="!subcategories.length" class="p-6 text-center text-gray-500">
        ูุง ุชูุฌุฏ ุชุตูููุงุช ูุฑุนูุฉ ูุทุงุจูุฉ ููุงุฎุชูุงุฑ ุงูุญุงูู.
      </div>
    </div>
  </section>
</section>
