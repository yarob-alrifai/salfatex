<section class="p-8 bg-gray-50 min-h-screen">
  <!-- Header -->
  <header class="mb-8 text-center">
    <h2 class="text-3xl font-bold text-indigo-600">ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช</h2>
    <p class="text-gray-600 mt-2">
      ูู ุจุฅุถุงูุฉ ููุชุฌุงุช ูุงููุฉ ุจุงูุตูุฑ ุงูุฑุฆูุณูุฉ ูุงููุนุฑุถ ูุงูุฑุจุท ูุน ุงูุชุตูููุงุช.
    </p>
  </header>

  <!-- Form -->
  <form
    [formGroup]="form"
    (ngSubmit)="saveProduct()"
    class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-white p-6 rounded-xl shadow"
  >
    <!-- Category -->
    <label class="flex flex-col text-right">
      <span class="mb-1 font-medium text-gray-700">ุงูุชุตููู</span>
      <select
        formControlName="categoryId"
        class="border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
      >
        <option value="" disabled>ุงุฎุชุฑ ุงูุชุตููู</option>
        <option *ngFor="let category of categories$ | async" [value]="category.id">
          {{ category.name }}
        </option>
      </select>
    </label>

    <!-- Subcategory -->
    <label class="flex flex-col text-right">
      <span class="mb-1 font-medium text-gray-700">ุงูุชุตููู ุงููุฑุนู</span>
      <select
        formControlName="subcategoryId"
        class="border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
      >
        <option value="">ุจุฏูู</option>
        <option *ngFor="let subcategory of filteredSubcategories$ | async" [value]="subcategory.id">
          {{ subcategory.name }}
        </option>
      </select>
    </label>

    <!-- Name -->
    <label class="flex flex-col text-right">
      <span class="mb-1 font-medium text-gray-700">ุงุณู ุงูููุชุฌ</span>
      <input
        formControlName="name"
        placeholder="ุงุณู ุงูููุชุฌ"
        class="border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
      />
    </label>
    <!-- Colors -->
    <div class="flex flex-col gap-2 text-right md:col-span-2" formArrayName="colors">
      <span class="font-medium text-gray-700">ุฃููุงู ุงูููุชุฌ</span>
      <div class="flex flex-col gap-2">
        <div
          class="flex items-center gap-2"
          *ngFor="let control of createColorControls; index as i"
        >
          <input
            [formControl]="control"
            placeholder="ููู ุงูููุชุฌ"
            class="flex-1 rounded-lg border border-gray-300 p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
          />
          <button
            type="button"
            class="rounded-lg border border-red-200 px-3 py-2 text-sm text-red-600 transition hover:bg-red-50"
            (click)="removeColorControl('create', i)"
            aria-label="ุฅุฒุงูุฉ ุงูููู"
          >
            ุญุฐู
          </button>
        </div>
      </div>
      <button
        type="button"
        class="self-start rounded-lg border border-dashed border-indigo-300 px-3 py-2 text-sm text-indigo-600 transition hover:bg-indigo-50"
        (click)="addColorControl('create')"
      >
        ุฅุถุงูุฉ ููู ุขุฎุฑ
      </button>
    </div>

    <!-- Unit Options -->
    <fieldset
      class="md:col-span-2 rounded-xl border border-gray-200 p-4"
      formGroupName="unitOptions"
    >
      <legend class="px-2 text-sm font-semibold text-gray-700">ุฎูุงุฑุงุช ุงูุจูุน ูุงูุชุณุนูุฑ</legend>
      <div class="grid gap-4 md:grid-cols-3">
        <div class="space-y-3 rounded-lg bg-gray-50 p-4">
          <label class="flex items-center justify-between text-sm font-medium text-gray-700">
            <span>ุจูุน ุจุงููุทุนุฉ</span>
            <input type="checkbox" formControlName="pieceEnabled" class="h-4 w-4" />
          </label>
          <label class="flex flex-col text-right text-sm text-gray-600">
            <span class="mb-1">ุณุนุฑ ุงููุทุนุฉ</span>
            <input
              type="number"
              formControlName="piecePrice"
              min="0"
              step="0.01"
              class="rounded-lg border border-gray-300 p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
            />
          </label>
        </div>

        <div class="space-y-3 rounded-lg bg-gray-50 p-4">
          <label class="flex items-center justify-between text-sm font-medium text-gray-700">
            <span>ุจูุน ุจุงููุฌููุนุฉ</span>
            <input type="checkbox" formControlName="bundleEnabled" class="h-4 w-4" />
          </label>
          <label class="flex flex-col text-right text-sm text-gray-600">
            <span class="mb-1">ุณุนุฑ ุงููุฌููุนุฉ</span>
            <input
              type="number"
              formControlName="bundlePrice"
              min="0"
              step="0.01"
              class="rounded-lg border border-gray-300 p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
              [disabled]="!form.get('unitOptions.bundleEnabled')?.value"
            />
          </label>
          <label class="flex flex-col text-right text-sm text-gray-600">
            <span class="mb-1">ุนุฏุฏ ุงููุทุน ูู ุงููุฌููุนุฉ</span>
            <input
              type="number"
              formControlName="bundlePiecesCount"
              min="0"
              step="1"
              class="rounded-lg border border-gray-300 p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
              [disabled]="!form.get('unitOptions.bundleEnabled')?.value"
            />
          </label>
        </div>

        <div class="space-y-3 rounded-lg bg-gray-50 p-4">
          <label class="flex items-center justify-between text-sm font-medium text-gray-700">
            <span>ุจูุน ุจุงููุฑุชููุฉ</span>
            <input type="checkbox" formControlName="cartonEnabled" class="h-4 w-4" />
          </label>
          <label class="flex flex-col text-right text-sm text-gray-600">
            <span class="mb-1">ุณุนุฑ ุงููุฑุชููุฉ</span>
            <input
              type="number"
              formControlName="cartonPrice"
              min="0"
              step="0.01"
              class="rounded-lg border border-gray-300 p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
              [disabled]="!form.get('unitOptions.cartonEnabled')?.value"
            />
          </label>
          <label class="flex flex-col text-right text-sm text-gray-600">
            <span class="mb-1">ุนุฏุฏ ุงููุทุน ูู ุงููุฑุชููุฉ</span>
            <input
              type="number"
              formControlName="cartonPiecesCount"
              min="0"
              step="1"
              class="rounded-lg border border-gray-300 p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
              [disabled]="!form.get('unitOptions.cartonEnabled')?.value"
            />
          </label>
        </div>
      </div>
    </fieldset>

    <!-- Description -->
    <label class="flex flex-col text-right md:col-span-2">
      <span class="mb-1 font-medium text-gray-700">ุงููุตู</span>
      <textarea
        formControlName="description"
        rows="4"
        placeholder="ุชูุงุตูู ุงูููุชุฌ"
        class="border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-indigo-400"
      ></textarea>
    </label>

    <!-- Main image -->
    <label class="flex flex-col text-right">
      <span class="mb-1 font-medium text-gray-700">ุตูุฑุฉ ุฑุฆูุณูุฉ</span>
      <input
        type="file"
        accept="image/*"
        (change)="onMainImageChange($event)"
        class="border border-gray-300 rounded-lg p-2 bg-gray-50"
      />
    </label>

    <div class="md:col-span-2 flex justify-end" *ngIf="mainImagePreview">
      <div class="relative w-32 h-32">
        <img
          [src]="mainImagePreview"
          alt="ูุนุงููุฉ ุงูุตูุฑุฉ ุงูุฑุฆูุณูุฉ"
          class="w-full h-full object-cover rounded-xl border border-gray-200 shadow-sm"
        />
        <button
          type="button"
          (click)="resetMainImage()"
          class="absolute -top-2 -left-2 bg-red-500 text-white w-7 h-7 rounded-full flex items-center justify-center shadow"
          aria-label="ุญุฐู ุงูุตูุฑุฉ ุงูุฑุฆูุณูุฉ"
        >
          โ
        </button>
      </div>
    </div>

    <!-- Gallery -->
    <label class="flex flex-col text-right">
      <span class="mb-1 font-medium text-gray-700">ูุนุฑุถ ุงูุตูุฑ</span>
      <input
        type="file"
        accept="image/*"
        multiple
        (change)="onGalleryChange($event)"
        class="border border-gray-300 rounded-lg p-2 bg-gray-50"
      />
    </label>

    <div class="md:col-span-2" *ngIf="galleryImagePreviews.length">
      <span class="block text-right text-sm font-medium text-gray-600 mb-2">ุงูุตูุฑ ุงููุฎุชุงุฑุฉ</span>
      <div class="flex flex-wrap justify-end gap-4">
        <ng-container *ngFor="let preview of galleryImagePreviews; let i = index">
          <div class="relative w-24 h-24">
            <img
              [src]="preview"
              class="w-full h-full object-cover rounded-xl border border-gray-200 shadow-sm"
              [alt]="'ุตูุฑุฉ ูููุนุฑุถ ุฑูู ' + (i + 1)"
            />
            <button
              type="button"
              (click)="removeGalleryImage(i)"
              class="absolute -top-2 -left-2 bg-red-500 text-white w-7 h-7 rounded-full flex items-center justify-center shadow"
              [attr.aria-label]="'ุญุฐู ุตูุฑุฉ ุงููุนุฑุถ ุฑูู ' + (i + 1)"
            >
              โ
            </button>
          </div>
        </ng-container>
      </div>
    </div>

    <!-- Submit -->
    <button
      type="submit"
      class="md:col-span-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-6 rounded-lg shadow transition"
    >
      ๐พ ุญูุธ ุงูููุชุฌ
    </button>

    <p class="md:col-span-2 text-center text-green-600 font-medium" *ngIf="feedback()">
      {{ feedback() }}
    </p>
  </form>

  <div
    *ngIf="showMainCropper"
    class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4"
  >
    <div class="w-full max-w-3xl bg-white rounded-2xl shadow-2xl p-6 space-y-4">
      <header class="flex items-center justify-between">
        <h3 class="text-lg font-semibold text-gray-800">ูุต ุงูุตูุฑุฉ ุงูุฑุฆูุณูุฉ</h3>
        <button
          type="button"
          (click)="cancelMainCrop()"
          class="text-gray-500 hover:text-gray-700 text-xl"
          aria-label="ุฅุบูุงู ุฃุฏุงุฉ ุงููุต"
        >
          โ
        </button>
      </header>
      <image-cropper
        [imageChangedEvent]="mainImageChangedEvent"
        [maintainAspectRatio]="true"
        [aspectRatio]="1"
        [resizeToWidth]="800"
        format="png"
        [cropperMinWidth]="200"
        [cropperMinHeight]="200"
        (imageCropped)="onMainImageCropped($event)"
        (imageLoaded)="onMainImageLoaded($event)"
        (loadImageFailed)="onMainImageLoadFailed()"
        class="block h-96"
      ></image-cropper>
      <div class="flex justify-end gap-3">
        <button
          type="button"
          (click)="cancelMainCrop()"
          class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300"
        >
          ุฅูุบุงุก
        </button>
        <button
          type="button"
          [disabled]="!mainCropReady"
          (click)="confirmMainCrop()"
          class="px-4 py-2 rounded-lg bg-indigo-600 text-white disabled:opacity-50 disabled:cursor-not-allowed"
        >
          ุงุนุชูุงุฏ ุงููุต
        </button>
      </div>
    </div>
  </div>

  <div
    *ngIf="showGalleryCropper && currentGalleryFile"
    class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4"
  >
    <div class="w-full max-w-3xl bg-white rounded-2xl shadow-2xl p-6 space-y-4">
      <header class="flex flex-col gap-1 text-right">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800">ูุต ุตูุฑ ุงููุนุฑุถ</h3>
          <button
            type="button"
            (click)="cancelGalleryCropping()"
            class="text-gray-500 hover:text-gray-700 text-xl"
            aria-label="ุฅุบูุงู ุฃุฏุงุฉ ูุต ุงููุนุฑุถ"
          >
            โ
          </button>
        </div>
        <span class="text-sm text-gray-500">
          ุงูุตูุฑุฉ {{ galleryImagePreviews.length + 1 }} ูู {{ totalGalleryToCrop }} โ
          {{ currentGalleryFile.name }}
        </span>
      </header>
      <image-cropper
        [imageFile]="currentGalleryFile"
        [maintainAspectRatio]="true"
        [aspectRatio]="1"
        [resizeToWidth]="800"
        format="png"
        [cropperMinWidth]="200"
        [cropperMinHeight]="200"
        (imageCropped)="onGalleryImageCropped($event)"
        (imageLoaded)="onGalleryImageLoaded($event)"
        (loadImageFailed)="onGalleryImageLoadFailed()"
        class="block h-96"
      ></image-cropper>
      <div class="flex justify-end gap-3">
        <button
          type="button"
          (click)="skipCurrentGalleryImage()"
          class="px-4 py-2 rounded-lg bg-amber-100 text-amber-700 hover:bg-amber-200"
        >
          ุชุฎุทู
        </button>
        <button
          type="button"
          (click)="cancelGalleryCropping()"
          class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300"
        >
          ุฅูุบุงุก
        </button>
        <button
          type="button"
          [disabled]="!currentGalleryCropReady"
          (click)="confirmGalleryCrop()"
          class="px-4 py-2 rounded-lg bg-indigo-600 text-white disabled:opacity-50 disabled:cursor-not-allowed"
        >
          ุญูุธ ุงูุตูุฑุฉ
        </button>
      </div>
    </div>
  </div>

  <!-- Product list -->
  <section class="mt-10 space-y-6" *ngIf="productsView$ | async as view">
    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
      <div class="relative w-full md:w-80">
        <span class="absolute inset-y-0 left-3 flex items-center text-gray-400">๐</span>
        <input
          type="search"
          [formControl]="searchControl"
          placeholder="ุงุจุญุซ ุนู ููุชุฌ..."
          class="w-full border border-gray-300 rounded-lg py-2 pr-3 pl-10 text-right focus:outline-none focus:ring-2 focus:ring-indigo-400"
        />
      </div>

      <span class="text-sm text-gray-600">ุฅุฌูุงูู ุงูููุชุฌุงุช: {{ view.total }}</span>
    </div>

    <div class="bg-white rounded-xl shadow overflow-hidden">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 text-right">
          <thead class="bg-gray-100 text-gray-700 text-sm">
            <tr>
              <th class="px-4 py-3 font-semibold">ุงูุงุณู</th>
              <th class="px-4 py-3 font-semibold">ุงููุตู</th>
              <th class="px-4 py-3 font-semibold">ุงููุณู</th>
              <th class="px-4 py-3 font-semibold">ุงููุณู ุงููุฑุนู</th>
              <th class="px-4 py-3 font-semibold">ุงูุณุนุฑ</th>
              <th class="px-4 py-3 font-semibold">ุงูุฃุณุนุงุฑ</th>

              <th class="px-4 py-3 font-semibold">ุงูุฅุฌุฑุงุกุงุช</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 text-sm text-gray-700">
            <tr *ngFor="let product of view.items" class="hover:bg-gray-50">
              <td class="px-4 py-3 font-medium text-gray-900">{{ product.name }}</td>
              <td class="px-4 py-3">{{ product.description || 'โ' }}</td>
              <td class="px-4 py-3">{{ product.categoryName || 'ุบูุฑ ูุญุฏุฏ' }}</td>
              <td class="px-4 py-3">{{ product.subcategoryName || 'โ' }}</td>
              <td class="px-4 py-3">
                <ng-container *ngIf="product.unitOptions?.length; else singlePrice">
                  <ul class="space-y-1 text-sm">
                    <li
                      *ngFor="let option of product.unitOptions"
                      class="flex flex-col items-end rounded-lg bg-indigo-50/30 px-2 py-1"
                    >
                      <span class="text-xs text-indigo-500">{{ getUnitOptionLabel(option) }}</span>
                      <span class="font-semibold text-indigo-600">
                        {{ option.price | currency : 'SAR' }}
                      </span>
                    </li>
                  </ul>
                </ng-container>
                <ng-template #singlePrice>
                  <span class="font-semibold text-indigo-600">
                    {{ product.price | currency : 'SAR' }}
                  </span>
                </ng-template>
              </td>
              <td class="px-4 py-3">
                <div class="flex items-center justify-end gap-2">
                  <button
                    type="button"
                    (click)="openEdit(product)"
                    class="bg-amber-500 hover:bg-amber-600 text-white py-1 px-3 rounded-lg shadow transition"
                  >
                    โ๏ธ ุชุนุฏูู
                  </button>
                  <button
                    type="button"
                    (click)="deleteProduct(product)"
                    class="bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded-lg shadow transition"
                  >
                    ๐๏ธ ุญุฐู
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div *ngIf="!view.items.length" class="p-6 text-center text-gray-500">
        ูุง ุชูุฌุฏ ููุชุฌุงุช ูุทุงุจูุฉ ูุจุญุซู.
      </div>
    </div>

    <div
      class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between"
      *ngIf="view.totalPages > 1"
    >
      <span class="text-sm text-gray-600">
        ุนุฑุถ
        <strong>{{ view.startIndex }}</strong>
        -
        <strong>{{ view.endIndex }}</strong>
        ูู
        <strong>{{ view.total }}</strong>
        ููุชุฌ
      </span>
      <div class="flex items-center justify-end gap-2">
        <button
          type="button"
          (click)="goToPage(view.pageIndex - 1, view.totalPages)"
          [disabled]="view.pageIndex === 0"
          class="px-3 py-1 rounded-lg border border-gray-300 text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100"
        >
          ุงูุณุงุจู
        </button>
        <button
          type="button"
          *ngFor="let page of view.pages"
          (click)="goToPage(page, view.totalPages)"
          class="px-3 py-1 rounded-lg border text-sm"
          [ngClass]="
            page === view.pageIndex
              ? 'border-indigo-500 bg-indigo-50 text-indigo-600'
              : 'border-gray-300 hover:bg-gray-100'
          "
        >
          {{ page + 1 }}
        </button>
        <button
          type="button"
          (click)="goToPage(view.pageIndex + 1, view.totalPages)"
          [disabled]="view.pageIndex === view.totalPages - 1"
          class="px-3 py-1 rounded-lg border border-gray-300 text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100"
        >
          ุงูุชุงูู
        </button>
      </div>
    </div>
  </section>

  <!-- Edit modal -->
  <div
    class="fixed inset-0 z-40 flex items-center justify-center bg-black/40 backdrop-blur overflow-y-auto"
    *ngIf="isEditModalOpen"
  >
    <div
      class="w-full max-w-3xl bg-white max-h-[90vh] rounded-2xl shadow-xl p-6 space-y-6 overflow-y-auto"
    >
      <div class="flex items-center justify-between">
        <h3 class="text-xl font-semibold text-gray-800">ุชุนุฏูู ุงูููุชุฌ</h3>
        <button
          type="button"
          (click)="closeEditModal()"
          class="text-gray-500 hover:text-gray-700"
          aria-label="ุฅุบูุงู"
        >
          โ๏ธ
        </button>
      </div>

      <form
        class="grid grid-cols-1 md:grid-cols-2 gap-4"
        [formGroup]="editForm"
        (ngSubmit)="saveProductEdits()"
      >
        <label class="flex flex-col text-right">
          <span class="mb-1 font-medium text-gray-700">ุงุณู ุงูููุชุฌ</span>
          <input
            formControlName="name"
            class="border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
          />
        </label>

        <div class="flex flex-col gap-2 text-right md:col-span-2" formArrayName="colors">
          <span class="font-medium text-gray-700">ุฃููุงู ุงูููุชุฌ</span>
          <div class="flex flex-col gap-2">
            <div
              class="flex items-center gap-2"
              *ngFor="let control of editColorControls; index as i"
            >
              <input
                [formControl]="control"
                class="flex-1 rounded-lg border border-gray-300 p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
                placeholder="ููู ุงูููุชุฌ"
              />
              <button
                type="button"
                class="rounded-lg border border-red-200 px-3 py-2 text-sm text-red-600 transition hover:bg-red-50"
                (click)="removeColorControl('edit', i)"
                aria-label="ุฅุฒุงูุฉ ุงูููู"
              >
                ุญุฐู
              </button>
            </div>
          </div>
          <button
            type="button"
            class="self-start rounded-lg border border-dashed border-indigo-300 px-3 py-2 text-sm text-indigo-600 transition hover:bg-indigo-50"
            (click)="addColorControl('edit')"
          >
            ุฅุถุงูุฉ ููู ุขุฎุฑ
          </button>
        </div>

        <fieldset
          class="md:col-span-2 rounded-xl border border-gray-200 p-4"
          formGroupName="unitOptions"
        >
          <legend class="px-2 text-sm font-semibold text-gray-700">ุฎูุงุฑุงุช ุงูุจูุน ูุงูุชุณุนูุฑ</legend>
          <div class="grid gap-4 md:grid-cols-3">
            <div class="space-y-3 rounded-lg bg-gray-50 p-4">
              <label class="flex items-center justify-between text-sm font-medium text-gray-700">
                <span>ุจูุน ุจุงููุทุนุฉ</span>
                <input type="checkbox" formControlName="pieceEnabled" class="h-4 w-4" />
              </label>
              <label class="flex flex-col text-right text-sm text-gray-600">
                <span class="mb-1">ุณุนุฑ ุงููุทุนุฉ</span>
                <input
                  type="number"
                  formControlName="piecePrice"
                  min="0"
                  step="0.01"
                  class="rounded-lg border border-gray-300 p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
                />
              </label>
            </div>

            <div class="space-y-3 rounded-lg bg-gray-50 p-4">
              <label class="flex items-center justify-between text-sm font-medium text-gray-700">
                <span>ุจูุน ุจุงููุฌููุนุฉ</span>
                <input type="checkbox" formControlName="bundleEnabled" class="h-4 w-4" />
              </label>
              <label class="flex flex-col text-right text-sm text-gray-600">
                <span class="mb-1">ุณุนุฑ ุงููุฌููุนุฉ</span>
                <input
                  type="number"
                  formControlName="bundlePrice"
                  min="0"
                  step="0.01"
                  class="rounded-lg border border-gray-300 p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
                  [disabled]="!editForm.get('unitOptions.bundleEnabled')?.value"
                />
              </label>
              <label class="flex flex-col text-right text-sm text-gray-600">
                <span class="mb-1">ุนุฏุฏ ุงููุทุน ูู ุงููุฌููุนุฉ</span>
                <input
                  type="number"
                  formControlName="bundlePiecesCount"
                  min="0"
                  step="1"
                  class="rounded-lg border border-gray-300 p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
                  [disabled]="!editForm.get('unitOptions.bundleEnabled')?.value"
                />
              </label>
            </div>

            <div class="space-y-3 rounded-lg bg-gray-50 p-4">
              <label class="flex items-center justify-between text-sm font-medium text-gray-700">
                <span>ุจูุน ุจุงููุฑุชููุฉ</span>
                <input type="checkbox" formControlName="cartonEnabled" class="h-4 w-4" />
              </label>
              <label class="flex flex-col text-right text-sm text-gray-600">
                <span class="mb-1">ุณุนุฑ ุงููุฑุชููุฉ</span>
                <input
                  type="number"
                  formControlName="cartonPrice"
                  min="0"
                  step="0.01"
                  class="rounded-lg border border-gray-300 p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
                  [disabled]="!editForm.get('unitOptions.cartonEnabled')?.value"
                />
              </label>
              <label class="flex flex-col text-right text-sm text-gray-600">
                <span class="mb-1">ุนุฏุฏ ุงููุทุน ูู ุงููุฑุชููุฉ</span>
                <input
                  type="number"
                  formControlName="cartonPiecesCount"
                  min="0"
                  step="1"
                  class="rounded-lg border border-gray-300 p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
                  [disabled]="!editForm.get('unitOptions.cartonEnabled')?.value"
                />
              </label>
            </div>
          </div>
        </fieldset>

        <label class="flex flex-col text-right">
          <span class="mb-1 font-medium text-gray-700">ุงูุชุตููู</span>
          <select
            formControlName="categoryId"
            class="border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
          >
            <option value="" disabled>ุงุฎุชุฑ ุงูุชุตููู</option>
            <option *ngFor="let category of categories$ | async" [value]="category.id">
              {{ category.name }}
            </option>
          </select>
        </label>

        <label class="flex flex-col text-right md:col-span-2">
          <span class="mb-1 font-medium text-gray-700">ุงูุชุตููู ุงููุฑุนู</span>
          <select
            formControlName="subcategoryId"
            class="border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
          >
            <option value="">ุจุฏูู</option>
            <option
              *ngFor="let subcategory of editFilteredSubcategories$ | async"
              [value]="subcategory.id"
            >
              {{ subcategory.name }}
            </option>
          </select>
        </label>

        <label class="flex flex-col text-right md:col-span-2">
          <span class="mb-1 font-medium text-gray-700">ุงููุตู</span>
          <textarea
            formControlName="description"
            rows="4"
            class="border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-indigo-400"
          ></textarea>
        </label>

        <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="space-y-3 text-right">
            <span class="block font-medium text-gray-700">ุงูุตูุฑุฉ ุงูุฑุฆูุณูุฉ ุงูุญุงููุฉ</span>
            <img
              *ngIf="editingProduct?.mainImageUrl; else noMainImage"
              [src]="editingProduct?.mainImageUrl"
              alt="ุงูุตูุฑุฉ ุงูุฑุฆูุณูุฉ"
              class="w-full rounded-lg border"
            />
            <ng-template #noMainImage>
              <p class="text-sm text-gray-500">ูุง ุชูุฌุฏ ุตูุฑุฉ ุฑุฆูุณูุฉ.</p>
            </ng-template>
            <label class="flex flex-col text-right">
              <span class="mb-1 font-medium text-gray-700">ุชุญุฏูุซ ุงูุตูุฑุฉ ุงูุฑุฆูุณูุฉ</span>
              <input
                type="file"
                accept="image/*"
                (change)="onEditMainImageChange($event)"
                class="border border-gray-300 rounded-lg p-2 bg-gray-50"
              />
            </label>
            <div
              *ngIf="editMainImageFile"
              class="flex items-center justify-between text-sm text-gray-600"
            >
              <span>{{ editMainImageFile.name }}</span>
              <button
                type="button"
                class="text-red-500 hover:text-red-600"
                (click)="clearEditMainImage()"
              >
                ุฅุฒุงูุฉ
              </button>
            </div>
          </div>

          <div class="space-y-3 text-right">
            <span class="block font-medium text-gray-700">ูุนุฑุถ ุงูุตูุฑ ุงูุญุงูู</span>
            <div *ngIf="editGalleryUrls.length; else emptyGallery" class="grid grid-cols-2 gap-3">
              <div *ngFor="let url of editGalleryUrls" class="relative">
                <img
                  [src]="url"
                  alt="ุตูุฑุฉ ุงูููุชุฌ"
                  class="w-full h-24 object-cover rounded-lg border"
                />
                <button
                  type="button"
                  class="absolute top-1 right-1 bg-red-500 text-white text-xs rounded-full px-2 py-0.5"
                  (click)="removeExistingGalleryImage(url)"
                >
                  ุฅุฒุงูุฉ
                </button>
              </div>
            </div>
            <ng-template #emptyGallery>
              <p class="text-sm text-gray-500">ูุง ุชูุฌุฏ ุตูุฑ ูู ุงููุนุฑุถ.</p>
            </ng-template>

            <label class="flex flex-col text-right">
              <span class="mb-1 font-medium text-gray-700">ุฅุถุงูุฉ ุตูุฑ ุฌุฏูุฏุฉ ูููุนุฑุถ</span>
              <input
                type="file"
                accept="image/*"
                multiple
                (change)="onEditGalleryChange($event)"
                class="border border-gray-300 rounded-lg p-2 bg-gray-50"
              />
            </label>

            <div *ngIf="editNewGalleryFiles.length" class="space-y-1 text-sm text-gray-600">
              <div
                *ngFor="let file of editNewGalleryFiles; let i = index"
                class="flex items-center justify-between"
              >
                <span>{{ file.name }}</span>
                <button
                  type="button"
                  class="text-red-500 hover:text-red-600"
                  (click)="removeNewGalleryImage(i)"
                >
                  ุฅุฒุงูุฉ
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="md:col-span-2 flex items-center justify-between">
          <p class="text-sm text-red-500" *ngIf="editFeedback">{{ editFeedback }}</p>
          <div class="flex items-center gap-3">
            <button
              type="button"
              (click)="closeEditModal()"
              class="px-4 py-2 rounded-lg border border-gray-300 text-gray-600 hover:bg-gray-100"
            >
              ุฅูุบุงุก
            </button>
            <button
              type="submit"
              class="px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white shadow"
            >
              ุญูุธ ุงูุชุนุฏููุงุช
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</section>
